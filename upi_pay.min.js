var REQ_URL="/interface/upi_intent.php?";var amount,link,orderNo;var timeInterval;$(function(){orderNo=window.location.search.substring(1);if(!orderNo){showError("Order not exist");return}orderNo=orderNo.replace("orderNo=","");cashier();queryOrder(true);var payType=localStorage.getItem("cheetah_pay_type");if(payType){$('.pay-type li[data="'+payType+'"]').addClass('check')}else{$('.pay-type li:first').addClass('check')}$('.pay-type li').click(function(){$('.pay-type .check').removeClass('check');$(this).addClass('check')});$('.pay-button').click(function(){if(!amount||!link){return}payType=$('.pay-type .check').attr('data');localStorage.setItem("cheetah_pay_type",payType);cashier(payType);var jump=document.getElementById("jump");jump.setAttribute('href',getUpiLink(payType));jump.click();wait()})});function getUpiLink(payType){var u=navigator.userAgent;var isIos=!!u.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/);var upiLink="";var cleanLink=link;if(payType==="paytmmp"){cleanLink=link.replace(/&url=[^&]*/g,'');upiLink=payType+"://"+((isIos||payType=="gpay")&&payType!="upi"?"upi/pay?":"pay?")+cleanLink}else{upiLink=payType+"://"+((isIos||payType=="gpay")&&payType!="upi"?"upi/pay?":"pay?")+link}return upiLink}function queryOrder(first){$.ajax({url:REQ_URL+'orderNo='+orderNo,type:"GET",success:function(data){let res=JSON.parse(data);if(res.ret==0){if(res.data.payState==1){if(first){amount=res.data.amount;link=res.data.link;$('.amount span').text(amount);$('.userId').text(res.data.userId);$('.pay-button span').text("â‚¹ "+amount)}if(link==""){window.location.href='result_pay.php?code=2&amt='+res.data.amount+'&tr_id='+orderNo}if(res.data.code==1&&link){window.location.href=link}$(".blankLink").attr('href',getUpiLink('upi'))}else if(res.data.payState==2){window.location.href='result_pay.php?code=1&amt='+res.data.amount+'&tr_id='+orderNo}else{window.location.href='result_pay.php?code=2&amt='+res.data.amount+'&tr_id='+orderNo}}else{showError(res.msg)}},error:function(e){showError("network connection error")}})}function showError(msg){$('.shawdow .msg').html(msg);$('.shawdow').show()}function wait(){setTimeout(function(){$(".wait").show();var waitTime=29;timeInterval=setInterval(function(){if(waitTime>=0){$(".wait .time").html('00 : '+(waitTime<10?'0'+waitTime:waitTime));if(waitTime%5==0){queryOrder(false)}waitTime--}else{clearInterval(timeInterval);$('.wait').hide()}},1000)},1200)}function cashier(ptype){$.ajax({url:'/interface/cashier_report.php',type:'post',dataType:'json',data:{oid:orderNo,pt:ptype},success:function(data){}})}function toast(msg,duration){duration=isNaN(duration)?3000:duration;var m=document.createElement('div');m.innerHTML=msg;m.style.cssText="padding:0.06rem; background:#000000; opacity:0.72; color:#FFFFFF; text-align:center; border-radius:0.2rem; position:fixed; top:50%; left:50%; transform:translate(-50%,-50%); -webkit-transform:translate(-50%,-50%); z-index:999; font-size: 0.3rem; min-width:50%; max-width: 70%;";document.body.appendChild(m);setTimeout(function(){var d=0.5;m.style.webkitTransition='-webkit-transform '+d+'s ease-in, opacity '+d+'s ease-in';m.style.opacity='0';setTimeout(function(){document.body.removeChild(m)},d*1000)},duration)}